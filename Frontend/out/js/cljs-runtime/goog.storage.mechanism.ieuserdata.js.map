{
"version":3,
"file":"goog.storage.mechanism.ieuserdata.js",
"lineCount":108,
"mappings":"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",
"sources":["goog/storage/mechanism/ieuserdata.js"],
"sourcesContent":["/**\n * @license\n * Copyright The Closure Library Authors.\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview Provides data persistence using IE userData mechanism.\n * UserData uses proprietary Element.addBehavior(), Element.load(),\n * Element.save(), and Element.XMLDocument() methods, see:\n * http://msdn.microsoft.com/en-us/library/ms531424(v=vs.85).aspx.\n */\n\n\n// TODO(user): We're trying to migrate all ES5 subclasses of Closure\n// Library to ES6. In ES6 this cannot be referenced before super is called. This\n// file has at least one this before a super call (in ES5) and cannot be\n// automatically upgraded to ES6 as a result. Please fix this if you have a\n// chance. Note: This can sometimes be caused by not calling the super\n// constructor at all. You can run the conversion tool yourself to see what it\n// does on this file: blaze run //javascript/refactoring/es6_classes:convert.\n\ngoog.provide('goog.storage.mechanism.IEUserData');\n\ngoog.require('goog.asserts');\ngoog.require('goog.iter.Iterator');\ngoog.require('goog.iter.StopIteration');\ngoog.require('goog.storage.mechanism.ErrorCode');\ngoog.require('goog.storage.mechanism.IterableMechanism');\ngoog.require('goog.structs.Map');\ngoog.require('goog.userAgent');\n\n\n\n/**\n * Provides a storage mechanism using IE userData.\n *\n * @param {string} storageKey The key (store name) to store the data under.\n * @param {string=} opt_storageNodeId The ID of the associated HTML element,\n *     one will be created if not provided.\n * @constructor\n * @extends {goog.storage.mechanism.IterableMechanism}\n * @final\n */\ngoog.storage.mechanism.IEUserData = function(storageKey, opt_storageNodeId) {\n  'use strict';\n  /**\n   * The key to store the data under.\n   *\n   * @private {string}\n   */\n  this.storageKey_ = storageKey;\n\n  /**\n   * The document element used for storing data.\n   *\n   * @private {?Element}\n   */\n  this.storageNode_ = null;\n\n  goog.storage.mechanism.IEUserData.base(this, 'constructor');\n\n  // Tested on IE6, IE7 and IE8. It seems that IE9 introduces some security\n  // features which make persistent (loaded) node attributes invisible from\n  // JavaScript.\n  if (goog.userAgent.IE && !goog.userAgent.isDocumentModeOrHigher(9)) {\n    if (!goog.storage.mechanism.IEUserData.storageMap_) {\n      goog.storage.mechanism.IEUserData.storageMap_ = new goog.structs.Map();\n    }\n    this.storageNode_ = /** @type {Element} */ (\n        goog.storage.mechanism.IEUserData.storageMap_.get(storageKey));\n    if (!this.storageNode_) {\n      if (opt_storageNodeId) {\n        this.storageNode_ = document.getElementById(opt_storageNodeId);\n      } else {\n        this.storageNode_ = document.createElement('userdata');\n        // This is a special IE-only method letting us persist data.\n        this.storageNode_['addBehavior']('#default#userData');\n        document.body.appendChild(this.storageNode_);\n      }\n      goog.storage.mechanism.IEUserData.storageMap_.set(\n          storageKey, this.storageNode_);\n    }\n\n\n    try {\n      // Availability check.\n      this.loadNode_();\n    } catch (e) {\n      this.storageNode_ = null;\n    }\n  }\n};\ngoog.inherits(\n    goog.storage.mechanism.IEUserData,\n    goog.storage.mechanism.IterableMechanism);\n\n\n/**\n * Encoding map for characters which are not encoded by encodeURIComponent().\n * See encodeKey_ documentation for encoding details.\n *\n * @type {!Object}\n * @const\n */\ngoog.storage.mechanism.IEUserData.ENCODE_MAP = {\n  '.': '.2E',\n  '!': '.21',\n  '~': '.7E',\n  '*': '.2A',\n  '\\'': '.27',\n  '(': '.28',\n  ')': '.29',\n  '%': '.'\n};\n\n\n/**\n * Global storageKey to storageNode map, so we save on reloading the storage.\n *\n * @type {?goog.structs.Map}\n * @private\n */\ngoog.storage.mechanism.IEUserData.storageMap_ = null;\n\n\n/**\n * Encodes anything other than [-a-zA-Z0-9_] using a dot followed by hex,\n * and prefixes with underscore to form a valid and safe HTML attribute name.\n *\n * We use URI encoding to do the initial heavy lifting, then escape the\n * remaining characters that we can't use. Since a valid attribute name can't\n * contain the percent sign (%), we use a dot (.) as an escape character.\n *\n * @param {string} key The key to be encoded.\n * @return {string} The encoded key.\n * @private\n */\ngoog.storage.mechanism.IEUserData.encodeKey_ = function(key) {\n  'use strict';\n  // encodeURIComponent leaves - _ . ! ~ * ' ( ) unencoded.\n  return '_' + encodeURIComponent(key).replace(/[.!~*'()%]/g, function(c) {\n    'use strict';\n    return goog.storage.mechanism.IEUserData.ENCODE_MAP[c];\n  });\n};\n\n\n/**\n * Decodes a dot-encoded and character-prefixed key.\n * See encodeKey_ documentation for encoding details.\n *\n * @param {string} key The key to be decoded.\n * @return {string} The decoded key.\n * @private\n */\ngoog.storage.mechanism.IEUserData.decodeKey_ = function(key) {\n  'use strict';\n  return decodeURIComponent(key.replace(/\\./g, '%')).substr(1);\n};\n\n\n/**\n * Determines whether or not the mechanism is available.\n *\n * @return {boolean} True if the mechanism is available.\n */\ngoog.storage.mechanism.IEUserData.prototype.isAvailable = function() {\n  'use strict';\n  return !!this.storageNode_;\n};\n\n\n/** @override */\ngoog.storage.mechanism.IEUserData.prototype.set = function(key, value) {\n  'use strict';\n  this.storageNode_.setAttribute(\n      goog.storage.mechanism.IEUserData.encodeKey_(key), value);\n  this.saveNode_();\n};\n\n\n/** @override */\ngoog.storage.mechanism.IEUserData.prototype.get = function(key) {\n  'use strict';\n  // According to Microsoft, values can be strings, numbers or booleans. Since\n  // we only save strings, any other type is a storage error. If we returned\n  // nulls for such keys, i.e., treated them as non-existent, this would lead\n  // to a paradox where a key exists, but it does not when it is retrieved.\n  // http://msdn.microsoft.com/en-us/library/ms531348(v=vs.85).aspx\n  var value = this.storageNode_.getAttribute(\n      goog.storage.mechanism.IEUserData.encodeKey_(key));\n  if (typeof value !== 'string' && value !== null) {\n    throw goog.storage.mechanism.ErrorCode.INVALID_VALUE;\n  }\n  return value;\n};\n\n\n/** @override */\ngoog.storage.mechanism.IEUserData.prototype.remove = function(key) {\n  'use strict';\n  this.storageNode_.removeAttribute(\n      goog.storage.mechanism.IEUserData.encodeKey_(key));\n  this.saveNode_();\n};\n\n\n/** @override */\ngoog.storage.mechanism.IEUserData.prototype.getCount = function() {\n  'use strict';\n  return this.getNode_().attributes.length;\n};\n\n\n/** @override */\ngoog.storage.mechanism.IEUserData.prototype.__iterator__ = function(opt_keys) {\n  'use strict';\n  var i = 0;\n  var attributes = this.getNode_().attributes;\n  var newIter = new goog.iter.Iterator();\n  newIter.nextValueOrThrow = function() {\n    'use strict';\n    if (i >= attributes.length) {\n      throw goog.iter.StopIteration;\n    }\n    var item = goog.asserts.assert(attributes[i++]);\n    if (opt_keys) {\n      return goog.storage.mechanism.IEUserData.decodeKey_(item.nodeName);\n    }\n    var value = item.nodeValue;\n    // The value must exist and be a string, otherwise it is a storage error.\n    if (typeof value !== 'string') {\n      throw goog.storage.mechanism.ErrorCode.INVALID_VALUE;\n    }\n    return value;\n  };\n\n  return newIter;\n};\n\n\n/** @override */\ngoog.storage.mechanism.IEUserData.prototype.clear = function() {\n  'use strict';\n  var node = this.getNode_();\n  for (var left = node.attributes.length; left > 0; left--) {\n    node.removeAttribute(node.attributes[left - 1].nodeName);\n  }\n  this.saveNode_();\n};\n\n\n/**\n * Loads the underlying storage node to the state we saved it to before.\n *\n * @private\n */\ngoog.storage.mechanism.IEUserData.prototype.loadNode_ = function() {\n  'use strict';\n  // This is a special IE-only method on Elements letting us persist data.\n  this.storageNode_['load'](this.storageKey_);\n};\n\n\n/**\n * Saves the underlying storage node.\n *\n * @private\n */\ngoog.storage.mechanism.IEUserData.prototype.saveNode_ = function() {\n  'use strict';\n  try {\n    // This is a special IE-only method on Elements letting us persist data.\n    // Do not try to assign this.storageNode_['save'] to a variable, it does\n    // not work. May throw an exception when the quota is exceeded.\n    this.storageNode_['save'](this.storageKey_);\n  } catch (e) {\n    throw goog.storage.mechanism.ErrorCode.QUOTA_EXCEEDED;\n  }\n};\n\n\n/**\n * Returns the storage node.\n *\n * @return {!Element} Storage DOM Element.\n * @private\n */\ngoog.storage.mechanism.IEUserData.prototype.getNode_ = function() {\n  'use strict';\n  // This is a special IE-only property letting us browse persistent data.\n  var doc = /** @type {Document} */ (this.storageNode_['XMLDocument']);\n  return doc.documentElement;\n};\n"],
"names":["goog","provide","require","storage","mechanism","IEUserData","goog.storage.mechanism.IEUserData","storageKey","opt_storageNodeId","storageKey_","storageNode_","base","userAgent","IE","isDocumentModeOrHigher","storageMap_","structs","Map","get","document","getElementById","createElement","body","appendChild","set","loadNode_","e","inherits","IterableMechanism","ENCODE_MAP","encodeKey_","goog.storage.mechanism.IEUserData.encodeKey_","key","encodeURIComponent","replace","c","decodeKey_","goog.storage.mechanism.IEUserData.decodeKey_","decodeURIComponent","substr","prototype","isAvailable","goog.storage.mechanism.IEUserData.prototype.isAvailable","goog.storage.mechanism.IEUserData.prototype.set","value","setAttribute","saveNode_","goog.storage.mechanism.IEUserData.prototype.get","getAttribute","ErrorCode","INVALID_VALUE","remove","goog.storage.mechanism.IEUserData.prototype.remove","removeAttribute","getCount","goog.storage.mechanism.IEUserData.prototype.getCount","getNode_","attributes","length","__iterator__","goog.storage.mechanism.IEUserData.prototype.__iterator__","opt_keys","i","newIter","iter","Iterator","nextValueOrThrow","newIter.nextValueOrThrow","StopIteration","item","asserts","assert","nodeName","nodeValue","clear","goog.storage.mechanism.IEUserData.prototype.clear","node","left","goog.storage.mechanism.IEUserData.prototype.loadNode_","goog.storage.mechanism.IEUserData.prototype.saveNode_","QUOTA_EXCEEDED","goog.storage.mechanism.IEUserData.prototype.getNode_","doc","documentElement"]
}
